<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title th:text="${game.title}">Game Detail</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        #map { height: 400px; width: 100%; margin: 20px 0; }
    </style>
</head>
<body>

<h1 th:text="${game.title}">Game Title</h1>

<table border="1" cellpadding="4">
    <tr><th>Sport</th><td th:text="${game.sport.name}">Sport</td></tr>
    <tr><th>Location</th><td th:text="${game.location.name}">Location</td></tr>
    <tr><th>Address</th><td th:text="${game.location.address}">Address</td></tr>
    <tr><th>Description</th><td th:text="${game.description}">Description</td></tr>
    <tr><th>Capacity</th><td th:text="${game.capacity}">Capacity</td></tr>
    <tr><th>Price pp</th><td th:text="${game.pricePerPerson}">Price</td></tr>
    <tr><th>State</th><td th:text="${game.state}">State</td></tr>
    <tr><th>Owner</th><td th:text="${game.owner.name}">Owner</td></tr>
</table>

<h2>Players</h2>
<table border="1" cellpadding="4">
    <thead>
    <tr><th>#</th><th>Name</th><th>Login</th></tr>
    </thead>
    <tbody>
    <tr th:each="p, stat : ${game.players}">
        <td th:text="${stat.count}">1</td>
        <td th:text="${p.name}">Player Name</td>
        <td th:text="${p.login}">login</td>
    </tr>
    <tr th:if="${#lists.isEmpty(game.players)}">
        <td colspan="3">No players yet</td>
    </tr>
    </tbody>
</table>

<div id="map"></div>

<div>
    <span th:if="${currentUser != null}">
        <form th:if="${!game.players.contains(currentUser)}"
              th:action="@{/games/{id}/join(id=${game.id})}" method="post" style="display:inline">
            <button type="submit">Join Game</button>
        </form>
        <form th:if="${game.players.contains(currentUser)}"
              th:action="@{/games/{id}/resign(id=${game.id})}" method="post" style="display:inline">
            <button type="submit">Resign Game</button>
        </form>
    </span>
    <span th:if="${currentUser == null}">
        <em>Please <a th:href="@{/login}">log in</a> to join or resign.</em>
    </span>
</div>

<p><button type="button" onclick="location.href='/games'">‚Üê Back to Games</button></p>

<script th:inline="javascript">
    /*<![CDATA[*/
    const lat = [[${game.location.latitude}]];
    const lng = [[${game.location.longitude}]];
    const locName = [[${#strings.escapeJavaScript(game.location.name)}]];

    const map = L.map('map').setView([lat, lng], 15);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    L.marker([lat, lng]).addTo(map)
        .bindPopup(locName)
        .openPopup();
    /*]]>*/
</script>

</body>
</html>
